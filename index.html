<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ëª¨ë‘ì˜ ìˆ˜ì‹œ 3ê°œë…„ ì…ì‹œê²°ê³¼ ë¹„êµ ì˜¨ë„ê³„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Noto Sans KR", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: linear-gradient(180deg, #ffe6d5 0%, #ffeef9 50%, #e9f6ff 100%);
  color: #222;
}

.page {
  max-width: 1200px;
  margin: 0 auto;
  padding: 12px 10px 60px;
}

/* ì œëª© ì˜ì—­ */
h1 {
  margin: 6px 0 4px;
  font-size: 26px;
  font-weight: 900;
}
.sub-title {
  font-size: 14px;
  font-weight: 700;
  margin-bottom: 2px;
}
.meta {
  font-size: 13px;
  font-weight: 800;
}

/* ì¹´ë“œ ê³µí†µ */
.card {
  background: #ffffff;
  border-radius: 18px;
  padding: 14px 16px;
  margin-top: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.10);
}

/* ê²€ìƒ‰ ì¹´ë“œ */
.card-search {
  box-shadow: 0 12px 32px rgba(0,0,0,0.12);
}

/* í˜„ì¬ ì„ íƒ vs ë¹„êµ ì¹´ë“œ */
.card-current {
  border-top: 6px solid #ff7a6d;
}
.card-compare {
  border-top: 6px solid #6b9bff;
}

/* ì¹´ë“œ ì œëª© */
.card-title {
  font-size: 15px;
  font-weight: 900;
  margin-bottom: 8px;
}

/* ê²€ìƒ‰ ì˜ì—­ 4ê°œ select + ë²„íŠ¼ */
.search-row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
  margin-bottom: 8px;
}
.search-row .field {
  flex: 1 1 0;
  min-width: 120px;
}

select {
  width: 100%;
  padding: 11px 12px;
  border-radius: 14px;
  border: 2px solid #ffb28b;
  font-size: 15px;
  font-weight: 800;
  background: #fffdfb;
}

/* ë²„íŠ¼ */
.btn-row {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  margin-top: 6px;
}
.btn {
  padding: 10px 16px;
  border-radius: 14px;
  border: none;
  font-size: 14px;
  font-weight: 900;
  cursor: pointer;
  white-space: nowrap;
}
.btn-main {
  background: linear-gradient(120deg,#ff7b61,#ff3d7a);
  color: #fff;
}
.btn-sub {
  background: #ffffff;
  border: 2px solid #eeeeee;
  color: #444;
}

/* ëª¨ë°”ì¼ì—ì„œ select / ë²„íŠ¼ í¬ê²Œ */
@media (max-width: 700px) {
  select {
    font-size: 17px;
    padding: 14px;
  }
  .btn {
    font-size: 16px;
    flex: 1 1 0;
    justify-content: center;
  }
  .btn-row {
    flex-wrap: wrap;
  }
}

/* ê²°ê³¼ ì„¤ëª… */
.result-header {
  font-size: 14px;
  font-weight: 800;
  margin-bottom: 4px;
}
.result-title {
  font-size: 15px;
  font-weight: 900;
}
.result-sub {
  font-size: 13px;
  color: #555;
  margin-bottom: 6px;
}

/* ì˜¨ë„ê³„ ì „ì²´ ì˜ì—­ */
.thermo-wrap {
  display: flex;
  gap: 14px;
  justify-content: center;
  align-items: flex-end;
  margin-top: 6px;
  flex-wrap: nowrap;
}
.thermo {
  width: 90px;
  text-align: center;
  font-weight: 900;
  font-size: 12px;
}
.thermo.year-2025 {
  transform: scale(1.05);
  filter: drop-shadow(0 0 5px rgba(255,100,50,0.45));
}

/* ìœ ë¦¬ê´€ */
.tube {
  position: relative;
  margin: 2px auto 0;
  width: 26px;
  height: 190px;
  border-radius: 18px;
  background: linear-gradient(180deg,#ffffff,#f1f1f1);
  box-shadow: inset 0 0 10px rgba(0,0,0,0.25);
  overflow: hidden;
}

/* ê°€ë¡œ ëˆˆê¸ˆì„  (1~6) */
.tick-line {
  position: absolute;
  left: 4px;
  right: 4px;
  height: 1px;
  background: rgba(120,120,120,0.55);
}
.tick-label {
  position: absolute;
  right: -24px;
  font-size: 11px;
  font-weight: 900;
  color: #555;
}

/* ê²Œì´ì§€ ì±„ì›Œì§€ëŠ” ë¶€ë¶„ */
.mercury {
  position: absolute;
  left: 4px;
  right: 4px;
  bottom: 0;
  border-radius: 999px;
  height: 0%;
  transition: height .6s ease-out;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
}

/* ë‚œì´ë„ ìƒ‰ìƒ */
.merc-hard {
  background: linear-gradient(180deg,#ff0022,#ff7b3a);
}
.merc-mid {
  background: linear-gradient(180deg,#ffb400,#ffe06b);
}
.merc-easy {
  background: linear-gradient(180deg,#33dd77,#bbff88);
}
.merc-veryeasy {
  background: linear-gradient(180deg,#33b0ff,#a8e4ff);
}

/* ë¹¨ê°„ ë™ê·¸ë¼ë¯¸ (ì¡°ê¸ˆ ì¤„ì„) */
.bulb {
  width: 34px;
  height: 34px;
  border-radius: 50%;
  margin: 6px auto 0;
  background: radial-gradient(circle at 30% 30%, #ff8aa0, #ff2f4c);
  box-shadow: 0 0 10px rgba(255,0,0,0.55);
}

/* ê°’ í‘œì‹œ */
.thermo-value {
  margin-top: 4px;
  font-size: 16px;
}

/* ëª¨ë°”ì¼ì—ì„œ ì˜¨ë„ê³„ ì¡°ê¸ˆ ì¤„ì´ê¸° */
@media (max-width: 700px) {
  .thermo-wrap {
    gap: 10px;
  }
  .tube {
    height: 170px;
  }
}

/* í…Œì´ë¸” */
table.result-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  font-size: 14px;
}
table.result-table th,
table.result-table td {
  text-align: center;
  padding: 7px 4px;
  border-bottom: 1px solid #eeeeee;
  border-right: 1px solid #eeeeee;
}
table.result-table th:last-child,
table.result-table td:last-child {
  border-right: none;
}
table.result-table th {
  background: #fff3eb;
  font-weight: 900;
}
table.result-table tr.highlight-2025 {
  background: #fff8d7;
  font-weight: 900;
  font-size: 15px;
}

/* ì¦ê° í…ìŠ¤íŠ¸ */
.diff-up {
  color: #e53935;
  font-weight: 900;
}
.diff-down {
  color: #1e88e5;
  font-weight: 900;
}
.diff-same {
  color: #555;
}

/* ë¹„êµ ì¹´ë“œ ë‚´ë¶€ */
.compare-item {
  margin-top: 8px;
  padding: 10px 10px 12px;
  border-radius: 14px;
  border: 2px dashed #dde5ff;
}
.compare-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}
.compare-label {
  font-size: 13px;
  font-weight: 900;
}
.compare-label small {
  font-size: 11px;
  color: #777;
}
.compare-index-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 22px;
  height: 22px;
  border-radius: 999px;
  background: #6b9bff;
  color: #fff;
  font-size: 11px;
  margin-right: 4px;
}
.btn-mini {
  padding: 4px 8px;
  border-radius: 999px;
  border: none;
  font-size: 11px;
  font-weight: 800;
  cursor: pointer;
  background: #f7f7ff;
}

/* ë¹ˆ ìƒíƒœ ì•ˆë‚´ */
.empty-text {
  font-size: 13px;
  color: #555;
}
</style>
</head>

<body>
<div class="page">
  <h1>ëª¨ë‘ì˜ ìˆ˜ì‹œ 3ê°œë…„ ì…ì‹œê²°ê³¼ ë¹„êµ ì˜¨ë„ê³„</h1>
  <div class="sub-title">ëŒ€í•™ Â· ëª¨ì§‘ë‹¨ìœ„ Â· ì „í˜•ìœ í˜• Â· ì„¸ë¶€ì „í˜•ì„ ì„ íƒí•˜ì—¬ 3ê°œë…„ 70% cutì„ í•œëˆˆì— ë¹„êµí•˜ì„¸ìš”.</div>
  <div class="meta">Copyright @All Teachers</div>
  <div class="meta">ì¶œì²˜: 3ê°œë…„ ì–´ë””ê°€ ìˆ˜ì‹œ ì…ì‹œê²°ê³¼</div>

  <!-- ê²€ìƒ‰ ì¹´ë“œ -->
  <div class="card card-search">
    <div class="card-title">ê²€ìƒ‰ ê¸°ì¤€ ì„ íƒ (ê°€ë¡œ 4ê°œ ë“œë¡­ë‹¤ìš´)</div>
    <div class="search-row">
      <div class="field">
        <select id="univSelect">
          <option value="">ëŒ€í•™ ì„ íƒ</option>
        </select>
      </div>
      <div class="field">
        <select id="majorSelect" disabled>
          <option value="">ëª¨ì§‘ë‹¨ìœ„ ì„ íƒ</option>
        </select>
      </div>
      <div class="field">
        <select id="typeSelect" disabled>
          <option value="">ì „í˜•ìœ í˜• ì„ íƒ</option>
        </select>
      </div>
      <div class="field">
        <select id="detailSelect" disabled>
          <option value="">ì„¸ë¶€ì „í˜• ì„ íƒ</option>
        </select>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-main" id="addCompareBtn" disabled>ï¼‹ ë¹„êµ ì¶”ê°€ (ìµœëŒ€ 3ê°œ)</button>
      <button class="btn btn-sub" id="resetBtn">ì„ íƒ ì´ˆê¸°í™”</button>
    </div>
  </div>

  <!-- í˜„ì¬ ì„ íƒ ê²°ê³¼ -->
  <div class="card card-current">
    <div class="card-title">í˜„ì¬ ì„ íƒ 1ê°œ ì „í˜•ì˜ 3ê°œë…„ ê²°ê³¼</div>
    <div id="currentResult">
      <p class="empty-text">
        ì•„ì§ ì„ íƒëœ ì „í˜•ì´ ì—†ìŠµë‹ˆë‹¤.<br>
        ìœ„ì—ì„œ ëŒ€í•™ â†’ ëª¨ì§‘ë‹¨ìœ„ â†’ ì „í˜•ìœ í˜• â†’ ì„¸ë¶€ì „í˜•ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”.
      </p>
    </div>
  </div>

  <!-- ë¹„êµ ëª©ë¡ -->
  <div class="card card-compare">
    <div class="card-title">ì„ íƒ ë¹„êµ ëª©ë¡ (ìµœëŒ€ 3ê°œê¹Œì§€ ëˆ„ì )</div>
    <div class="empty-text" id="compareEmpty">ë¹„êµ ëª©ë¡ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. 'ë¹„êµ ì¶”ê°€' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì „í˜•ì„ ëˆ„ì í•˜ì„¸ìš”.</div>
    <div id="compareList"></div>
  </div>
</div>

<script>
const YEARS = [2025, 2024, 2023];
let DATA = [];
let INDEX = {};   // ë¹ ë¥¸ ì¡°íšŒìš© ì¸ë±ìŠ¤ {ëŒ€í•™ëª…->{ëª¨ì§‘ë‹¨ìœ„->{ì¤‘ì‹¬ì „í˜•->{ì „í˜•ëª…->{ì—°ë„:row}}}}}
let compareSelections = [];

const univSelect   = document.getElementById("univSelect");
const majorSelect  = document.getElementById("majorSelect");
const typeSelect   = document.getElementById("typeSelect");
const detailSelect = document.getElementById("detailSelect");
const addCompareBtn = document.getElementById("addCompareBtn");
const resetBtn       = document.getElementById("resetBtn");
const currentResultBox = document.getElementById("currentResult");
const compareListBox   = document.getElementById("compareList");
const compareEmptyText = document.getElementById("compareEmpty");

/* ìœ í‹¸ */
function extractYear(value) {
  const s = String(value ?? "");
  const m = s.match(/(\d{4})/);
  return m ? m[1] : null;
}
function unique(arr) {
  return [...new Set(arr)].sort((a,b)=>a.localeCompare(b,"ko"));
}

/* ë°ì´í„° ë¡œë“œ & ì¸ë±ìŠ¤ ìƒì„± */
async function loadData() {
  try {
    const res = await fetch("data/data.json");
    const raw = await res.json();
    DATA = raw || [];
    buildIndex();
    initUnivSelect();
  } catch (e) {
    console.error(e);
    univSelect.innerHTML = "<option value=''>data/data.json ë¡œë“œ ì‹¤íŒ¨</option>";
    alert("data/data.json ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê²½ë¡œ/íŒŒì¼ëª…ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
  }
}

/* ì¸ë±ìŠ¤ êµ¬ì¡°ë¡œ ë¯¸ë¦¬ êµ¬ì„± (ì†ë„ í–¥ìƒ í•µì‹¬) */
function buildIndex() {
  INDEX = {};
  for (const row of DATA) {
    const univ = row["ëŒ€í•™ëª…"];
    const major = row["ëª¨ì§‘ë‹¨ìœ„"];
    const type  = row["ì¤‘ì‹¬ì „í˜•"];
    const detail= row["ì „í˜•ëª…"];
    const y = extractYear(row["ì—°ë„"]);
    if (!univ || !major || !type || !detail || !y) continue;

    if (!INDEX[univ]) INDEX[univ] = {};
    if (!INDEX[univ][major]) INDEX[univ][major] = {};
    if (!INDEX[univ][major][type]) INDEX[univ][major][type] = {};
    if (!INDEX[univ][major][type][detail]) INDEX[univ][major][type][detail] = {};
    INDEX[univ][major][type][detail][y] = row;
  }
}

/* ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” */
function initUnivSelect() {
  const univs = Object.keys(INDEX).sort((a,b)=>a.localeCompare(b,"ko"));
  fillSelect(univSelect, univs, "ëŒ€í•™ ì„ íƒ");
  univSelect.disabled = false;
}

function fillSelect(select, items, placeholder) {
  select.innerHTML = "";
  const opt = document.createElement("option");
  opt.value = "";
  opt.textContent = placeholder;
  select.appendChild(opt);
  items.forEach(v => {
    const o = document.createElement("option");
    o.value = v;
    o.textContent = v;
    select.appendChild(o);
  });
}

function disableSelect(sel, message) {
  sel.disabled = true;
  sel.innerHTML = "";
  const opt = document.createElement("option");
  opt.value = "";
  opt.textContent = message;
  sel.appendChild(opt);
}

/* ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸ */
univSelect.addEventListener("change", () => {
  const univ = univSelect.value;
  disableSelect(majorSelect, "ëª¨ì§‘ë‹¨ìœ„ ì„ íƒ");
  disableSelect(typeSelect, "ì „í˜•ìœ í˜• ì„ íƒ");
  disableSelect(detailSelect, "ì„¸ë¶€ì „í˜• ì„ íƒ");
  addCompareBtn.disabled = true;
  renderCurrentResult(null);

  if (!univ || !INDEX[univ]) return;
  const majors = Object.keys(INDEX[univ]).sort((a,b)=>a.localeCompare(b,"ko"));
  fillSelect(majorSelect, majors, "ëª¨ì§‘ë‹¨ìœ„ ì„ íƒ");
  majorSelect.disabled = true;
  typeSelect.disabled = true;
  detailSelect.disabled = true;
  majorSelect.disabled = false;
});

majorSelect.addEventListener("change", () => {
  const univ = univSelect.value;
  const major = majorSelect.value;
  disableSelect(typeSelect, "ì „í˜•ìœ í˜• ì„ íƒ");
  disableSelect(detailSelect, "ì„¸ë¶€ì „í˜• ì„ íƒ");
  addCompareBtn.disabled = true;
  renderCurrentResult(null);

  if (!univ || !major || !INDEX[univ] || !INDEX[univ][major]) return;
  const types = Object.keys(INDEX[univ][major]).sort((a,b)=>a.localeCompare(b,"ko"));
  fillSelect(typeSelect, types, "ì „í˜•ìœ í˜• ì„ íƒ");
  typeSelect.disabled = false;
});

typeSelect.addEventListener("change", () => {
  const univ = univSelect.value;
  const major= majorSelect.value;
  const type = typeSelect.value;
  disableSelect(detailSelect, "ì„¸ë¶€ì „í˜• ì„ íƒ");
  addCompareBtn.disabled = true;
  renderCurrentResult(null);

  if (!univ || !major || !type || !INDEX[univ]?.[major]?.[type]) return;
  const details = Object.keys(INDEX[univ][major][type]).sort((a,b)=>a.localeCompare(b,"ko"));
  fillSelect(detailSelect, details, "ì„¸ë¶€ì „í˜• ì„ íƒ");
  detailSelect.disabled = false;
});

detailSelect.addEventListener("change", () => {
  const univ = univSelect.value;
  const major= majorSelect.value;
  const type = typeSelect.value;
  const detail = detailSelect.value;

  const valid = univ && major && type && detail;
  addCompareBtn.disabled = !valid;
  if (!valid) {
    renderCurrentResult(null);
  } else {
    const selection = { univ, major, type, detail };
    renderCurrentResult(selection);
  }
});

/* ì„ íƒëœ ì „í˜•ì˜ 3ê°œë…„ row ê°€ì ¸ì˜¤ê¸° (ì¸ë±ìŠ¤ ì‚¬ìš©) */
function getRowsForSelection(sel) {
  if (!sel) return null;
  const { univ, major, type, detail } = sel;
  const rowsByYear = {};
  YEARS.forEach(y => {
    const key = String(y);
    rowsByYear[y] = INDEX[univ]?.[major]?.[type]?.[detail]?.[key] || null;
  });
  return rowsByYear;
}

/* ì˜¨ë„ê³„ ë¸”ë¡ ìƒì„± */
function createThermoBlock(rowsByYear) {
  const wrap = document.createElement("div");
  wrap.className = "thermo-wrap";

  YEARS.forEach(year => {
    const col = document.createElement("div");
    col.className = "thermo";
    if (year === 2025) col.classList.add("year-2025");

    // ì—°ë„ ë¼ë²¨
    const yearLabel = document.createElement("div");
    yearLabel.textContent = year + "í•™ë…„ë„";
    col.appendChild(yearLabel);

    // íŠœë¸Œ
    const tube = document.createElement("div");
    tube.className = "tube";

    // ëˆˆê¸ˆì„  + ìˆ«ì (1~6)
    for (let grade=1; grade<=6; grade++) {
      const tick = document.createElement("div");
      tick.className = "tick-line";
      // grade=1 -> ìƒë‹¨, grade=6 -> í•˜ë‹¨ ê·¼ì²˜
      const pos = ((6 - grade) / 5) * 100;
      tick.style.bottom = pos + "%";

      const label = document.createElement("div");
      label.className = "tick-label";
      label.style.bottom = pos - 3 + "%";
      label.textContent = grade.toFixed(0);

      tube.appendChild(tick);
      tube.appendChild(label);
    }

    const row = rowsByYear[year];
    let v = null;
    if (row && row["70% cut"] !== undefined && row["70% cut"] !== "") {
      const n = Number(row["70% cut"]);
      if (!Number.isNaN(n)) v = n;
    }

    // ì±„ì›Œì§€ëŠ” ë¶€ë¶„
    const mercury = document.createElement("div");
    mercury.className = "mercury";

    // ê°’ì— ë”°ë¥¸ ë†’ì´ ê³¼ì¥ (ì‹œê°í™”)
    let heightPercent = 0;
    let text = "ë°ì´í„° ì—†ìŒ";

    if (v !== null) {
      // ë“±ê¸‰ì´ ë‚®ì„ìˆ˜ë¡ (1ì— ê°€ê¹Œìš¸ìˆ˜ë¡) ë” ë†’ê²Œ
      const minV = 1.0;
      const maxV = 6.0;
      let norm = (maxV - v) / (maxV - minV); // 1ë“±ê¸‰â†’1, 6ë“±ê¸‰â†’0
      if (norm < 0) norm = 0;
      if (norm > 1) norm = 1;

      // ê³¼ì¥ ê³„ìˆ˜: ì‘ì€ ì°¨ì´ë¥¼ í¬ê²Œ ë³´ì´ë„ë¡
      const exaggerated = Math.pow(norm, 1.4);
      heightPercent = 12 + 80 * exaggerated; // ìµœì†Œ 12%, ìµœëŒ€ 92%

      text = v.toFixed(2) + "ë“±ê¸‰";

      // ë‚œì´ë„ ìƒ‰ìƒ
      if (v <= 2.0) {
        mercury.classList.add("merc-hard");
      } else if (v <= 3.0) {
        mercury.classList.add("merc-mid");
      } else if (v <= 4.0) {
        mercury.classList.add("merc-easy");
      } else {
        mercury.classList.add("merc-veryeasy");
      }
    } else {
      heightPercent = 4;
      mercury.style.background = "linear-gradient(180deg,#cccccc,#eeeeee)";
      text = "ë°ì´í„° ì—†ìŒ";
    }

    tube.appendChild(mercury);
    col.appendChild(tube);

    // ë¹¨ê°„ ë™ê·¸ë¼ë¯¸
    const bulb = document.createElement("div");
    bulb.className = "bulb";
    col.appendChild(bulb);

    // ê°’ í…ìŠ¤íŠ¸
    const value = document.createElement("div");
    value.className = "thermo-value";
    value.textContent = text;
    col.appendChild(value);

    // ì• ë‹ˆë©”ì´ì…˜ ì ìš©
    setTimeout(() => {
      mercury.style.height = heightPercent + "%";
    }, 50);

    wrap.appendChild(col);
  });

  return wrap;
}

/* ì¦ê° í…ìŠ¤íŠ¸ ìƒì„± (70% cut ê¸°ì¤€) */
function createDiffText(currentRow, prevRow) {
  if (!currentRow || !prevRow) return { html: "-", cls: "diff-same" };

  const c = Number(currentRow["70% cut"]);
  const p = Number(prevRow["70% cut"]);
  if (Number.isNaN(c) || Number.isNaN(p)) return { html: "-", cls: "diff-same" };

  const diff = (p - c); // ì´ì „ - ì§€ê¸ˆ
  if (diff > 0) {
    // ì ìˆ˜ê°€ ë‚®ì•„ì§ = ë‚œì´ë„ ìƒìŠ¹
    return { html: `â–² ${Math.abs(diff).toFixed(2)} ìƒìŠ¹`, cls: "diff-up" };
  } else if (diff < 0) {
    // ì ìˆ˜ê°€ ë†’ì•„ì§ = ë‚œì´ë„ í•˜ë½
    return { html: `â–¼ ${Math.abs(diff).toFixed(2)} í•˜ë½`, cls: "diff-down" };
  } else {
    return { html: "â– ë™ì¼", cls: "diff-same" };
  }
}

/* í…Œì´ë¸” ë¸”ë¡ ìƒì„± */
function createTableBlock(rowsByYear) {
  const table = document.createElement("table");
  table.className = "result-table";

  const headerRow = document.createElement("tr");
  ["ì—°ë„","50% cut","70% cut","ì¦ê°(70%)","ëª¨ì§‘ì¸ì›","ê²½ìŸë¥ ","ì¶©ì›ìˆœìœ„"].forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    headerRow.appendChild(th);
  });
  table.appendChild(headerRow);

  YEARS.forEach((year, idx) => {
    const tr = document.createElement("tr");
    if (year === 2025) tr.classList.add("highlight-2025");

    const row = rowsByYear[year];
    const prevYear = YEARS[idx+1]; // 2025 ê¸°ì¤€ ì´ì „: 2024, 2024 ê¸°ì¤€ ì´ì „: 2023
    const prevRow = rowsByYear[prevYear];

    const diff = createDiffText(row, prevRow);

    function val(key) {
      if (!row || row[key] == null || row[key] === "") return "-";
      return row[key];
    }

    const cols = [
      year,
      val("50% cut"),
      val("70% cut"),
      { diff: diff }, // íŠ¹ìˆ˜ ì²˜ë¦¬
      val("ëª¨ì§‘ì¸ì›"),
      val("ê²½ìŸë¥ "),
      val("ì¶©ì›ìˆœìœ„")
    ];

    cols.forEach((v, i) => {
      const td = document.createElement("td");
      if (i === 3 && v && v.diff) {
        td.innerHTML = `<span class="${v.diff.cls}">${v.diff.html}</span>`;
      } else {
        td.textContent = v;
      }
      tr.appendChild(td);
    });

    table.appendChild(tr);
  });

  return table;
}

/* ê²°ê³¼ ë¸”ë¡ (ì˜¨ë„ê³„ + í…Œì´ë¸” + ì œëª©) */
function createResultBlock(selection, rowsByYear) {
  const container = document.createElement("div");

  const title = document.createElement("div");
  title.className = "result-title";
  title.textContent = `${selection.univ} / ${selection.major}`;
  container.appendChild(title);

  const sub = document.createElement("div");
  sub.className = "result-sub";
  sub.textContent = `[${selection.type}] ${selection.detail} Â· 3ê°œë…„ 70% cut ì˜¨ë„ê³„ + ë°ì´í„°í‘œ ë¹„êµ`;
  container.appendChild(sub);

  const header = document.createElement("div");
  header.className = "result-header";
  header.textContent = "ğŸŒ¡ ì˜¨ë„ê³„ëŠ” 70% cut ê¸°ì¤€ìœ¼ë¡œ, ë“±ê¸‰ì´ ë‚®ì„ìˆ˜ë¡(ë‚œì´ë„ ë†’ì„ìˆ˜ë¡) ê²Œì´ì§€ê°€ ë†’ê²Œ í‘œì‹œë©ë‹ˆë‹¤.";
  container.appendChild(header);

  container.appendChild(createThermoBlock(rowsByYear));

  const header2 = document.createElement("div");
  header2.className = "result-header";
  header2.style.marginTop = "8px";
  header2.textContent = "ğŸ“Š 3ê°œë…„ 50% Â· 70% Â· ëª¨ì§‘ì¸ì› Â· ê²½ìŸë¥  Â· ì¶©ì›ìˆœìœ„ë¥¼ í•¨ê»˜ í™•ì¸í•´ ë³´ì„¸ìš”. (2025 í•˜ì´ë¼ì´íŠ¸)";
  container.appendChild(header2);

  container.appendChild(createTableBlock(rowsByYear));

  return container;
}

/* í˜„ì¬ ì„ íƒ ê²°ê³¼ ë Œë”ë§ */
function renderCurrentResult(selection) {
  currentResultBox.innerHTML = "";
  if (!selection) {
    const p = document.createElement("p");
    p.className = "empty-text";
    p.innerHTML = "ì•„ì§ ì„ íƒëœ ì „í˜•ì´ ì—†ìŠµë‹ˆë‹¤.<br>ëŒ€í•™ Â· ëª¨ì§‘ë‹¨ìœ„ Â· ì „í˜•ìœ í˜• Â· ì„¸ë¶€ì „í˜•ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”.";
    currentResultBox.appendChild(p);
    return;
  }

  const rowsByYear = getRowsForSelection(selection);
  const hasAny = YEARS.some(y => rowsByYear[y]);
  if (!hasAny) {
    const p = document.createElement("p");
    p.className = "empty-text";
    p.textContent = "í•´ë‹¹ ì „í˜•ì— ëŒ€í•œ 3ê°œë…„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
    currentResultBox.appendChild(p);
    return;
  }

  currentResultBox.appendChild(createResultBlock(selection, rowsByYear));
}

/* ë¹„êµ ëª©ë¡ ë Œë”ë§ */
function renderCompareList() {
  compareListBox.innerHTML = "";
  if (compareSelections.length === 0) {
    compareEmptyText.style.display = "block";
    return;
  }
  compareEmptyText.style.display = "none";

  compareSelections.forEach((sel, index) => {
    const rowsByYear = getRowsForSelection(sel);
    const hasAny = YEARS.some(y => rowsByYear[y]);

    const item = document.createElement("div");
    item.className = "compare-item";

    const header = document.createElement("div");
    header.className = "compare-header";

    const left = document.createElement("div");
    left.className = "compare-label";
    left.innerHTML =
      `<span class="compare-index-badge">${index+1}</span>` +
      `${sel.univ} / ${sel.major}` +
      `<br><small>[${sel.type}] ${sel.detail}</small>`;

    const right = document.createElement("div");
    const btnDel = document.createElement("button");
    btnDel.className = "btn-mini";
    btnDel.textContent = "ì‚­ì œ";
    btnDel.onclick = () => {
      compareSelections.splice(index, 1);
      renderCompareList();
    };
    right.appendChild(btnDel);

    header.appendChild(left);
    header.appendChild(right);
    item.appendChild(header);

    if (!hasAny) {
      const p = document.createElement("p");
      p.className = "empty-text";
      p.textContent = "ì´ ì „í˜•ì€ 3ê°œë…„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
      item.appendChild(p);
    } else {
      item.appendChild(createResultBlock(sel, rowsByYear));
    }

    compareListBox.appendChild(item);
  });
}

/* ë¹„êµ ì¶”ê°€ ë²„íŠ¼ */
addCompareBtn.addEventListener("click", () => {
  const univ = univSelect.value;
  const major= majorSelect.value;
  const type = typeSelect.value;
  const detail= detailSelect.value;

  if (!univ || !major || !type || !detail) {
    alert("ëŒ€í•™, ëª¨ì§‘ë‹¨ìœ„, ì „í˜•ìœ í˜•, ì„¸ë¶€ì „í˜•ì„ ëª¨ë‘ ì„ íƒí•œ í›„ ë¹„êµë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”.");
    return;
  }
  if (compareSelections.length >= 3) {
    alert("ë¹„êµ ëª©ë¡ì€ ìµœëŒ€ 3ê°œê¹Œì§€ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    return;
  }

  // ì¤‘ë³µ ë°©ì§€
  const exists = compareSelections.some(s =>
    s.univ===univ && s.major===major && s.type===type && s.detail===detail
  );
  if (exists) {
    alert("ì´ë¯¸ ë¹„êµ ëª©ë¡ì— ìˆëŠ” ì „í˜•ì…ë‹ˆë‹¤.");
    return;
  }

  const sel = { univ, major, type, detail };
  compareSelections.push(sel);
  renderCompareList();
});

/* ì´ˆê¸°í™” ë²„íŠ¼ */
resetBtn.addEventListener("click", () => {
  univSelect.selectedIndex = 0;
  disableSelect(majorSelect, "ëª¨ì§‘ë‹¨ìœ„ ì„ íƒ");
  disableSelect(typeSelect, "ì „í˜•ìœ í˜• ì„ íƒ");
  disableSelect(detailSelect, "ì„¸ë¶€ì „í˜• ì„ íƒ");
  addCompareBtn.disabled = true;
  compareSelections = [];
  renderCurrentResult(null);
  renderCompareList();
});

/* ì´ˆê¸° ì‹¤í–‰ */
loadData();
renderCompareList();
</script>
</body>
</html>
