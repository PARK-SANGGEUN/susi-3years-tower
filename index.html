<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ëª¨ë‘ì˜ ìˆ˜ì‹œ 3ê°œë…„ ì…ì‹œê²°ê³¼ ë¹„êµ TOWER</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
*{ box-sizing:border-box; }

body{
  margin:0;
  font-family:"Noto Sans KR", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: radial-gradient(circle at 0% 0%, #ffe4c7 0, #ffeef9 45%, #e9f6ff 100%);
  color:#222;
}
.page{
  max-width:1200px;
  margin:0 auto;
  padding:14px 10px 70px;
}

/* ìº”ë²„ìŠ¤ íŒŒí‹°í´ ë°°ê²½ */
#towerParticles{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:-1;
}

/* ===== í—¤ë” ===== */
h1{
  margin:6px 0 6px;
  font-size:28px;
  font-weight:900;
  letter-spacing:-0.2px;
}
.sub-title{
  font-size:15px;
  font-weight:800;
  line-height:1.45;
  margin-bottom:4px;
}
.meta{
  font-size:13px;
  font-weight:800;
  color:#333;
}
.meta-strong{
  margin-top:6px;
  font-size:14px;
  font-weight:1000;
  color:#111;
  text-shadow:0 1px 0 rgba(255,255,255,.7);
}

/* =========================================================
   ğŸŒˆ ê¸€ë˜ìŠ¤ ì¹´ë“œ ë ˆì´ì•„ì›ƒ
========================================================= */
.card{
  position:relative;
  background:linear-gradient(145deg, rgba(255,255,255,.92), rgba(255,255,255,.78));
  border-radius:24px;
  padding:16px 18px 16px;
  margin-top:14px;
  border:1px solid rgba(255,255,255,.8);
  box-shadow:
    0 14px 40px rgba(15,23,42,.16),
    inset 0 0 0 1px rgba(255,255,255,.35);
  backdrop-filter:blur(18px);
}
.card::before{
  /* í…Œë‘ë¦¬ ì•ˆìª½ ì€ì€í•œ ê·¸ë¼ë””ì–¸íŠ¸ */
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  pointer-events:none;
  background:linear-gradient(135deg,
    rgba(255,255,255,.7),
    rgba(255,255,255,0),
    rgba(143,181,255,.14));
  mix-blend-mode:soft-light;
}
.card-search{
  box-shadow:
    0 18px 48px rgba(0,0,0,.18),
    inset 0 0 0 1px rgba(255,255,255,.4);
}
.card-current{
  border-top:5px solid rgba(255,123,111,.9);
}
.card-compare{
  border-top:5px solid rgba(103,140,255,.9);
}

.card-title{
  position:relative;
  font-size:15px;
  font-weight:1000;
  margin-bottom:10px;
}

/* ===== ê²€ìƒ‰ ===== */
.search-row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
  margin-bottom:10px;
}
.search-row .field{ flex:1 1 0; min-width:130px; }

select{
  width:100%;
  padding:11px 12px;
  border-radius:16px;
  border:2px solid rgba(255,178,139,.9);
  font-size:15px;
  font-weight:900;
  background:linear-gradient(145deg,#fffdf9,#fff6ee);
  box-shadow:0 4px 12px rgba(0,0,0,.04);
}

.btn-row{
  display:flex;
  gap:8px;
  justify-content:flex-end;
  margin-top:6px;
  flex-wrap:wrap;
}
.btn{
  padding:10px 16px;
  border-radius:999px;
  border:none;
  font-size:14px;
  font-weight:1000;
  cursor:pointer;
  white-space:nowrap;
  box-shadow:0 6px 18px rgba(0,0,0,.12);
}
.btn-main{
  background:linear-gradient(130deg,#ff7b61,#ff3d7a);
  color:#fff;
}
.btn-sub{
  background:linear-gradient(135deg,#ffffff,#f4f5fb);
  border:1px solid #e5e7f5;
  color:#444;
  box-shadow:none;
}
.btn-ghost{
  background:linear-gradient(135deg,#f4f6ff,#eef2ff);
  border:1px solid #dde4ff;
  color:#2f4ecb;
  box-shadow:none;
}

@media (max-width:700px){
  select{ font-size:17px; padding:14px; }
  .btn{ font-size:15px; flex:1 1 0; }
}

/* ===== ê²°ê³¼ í…ìŠ¤íŠ¸ ===== */
.result-header{ font-size:14px; font-weight:900; margin-bottom:6px; }
.result-title{ font-size:15px; font-weight:1000; }
.result-sub{ font-size:13px; color:#555; margin-bottom:6px; }

/* =========================================================
   ğŸ”¥ ìŠˆí¼ 3D SCORE TOWER
========================================================= */
.tower-stage{
  position:relative;
  border-radius:22px;
  padding:16px 14px 14px;
  margin-top:6px;
  background:radial-gradient(circle at 0% 0%,rgba(255,210,180,.55),transparent 55%),
             radial-gradient(circle at 100% 0%,rgba(184,199,255,.5),transparent 55%),
             linear-gradient(180deg,#ffffff 0%,#fff8ff 45%,#f2fbff 100%);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.65),
    0 18px 40px rgba(15,23,42,.16);
  overflow:hidden;
}
.tower-wrap{
  position:relative;
  display:flex;
  gap:26px;
  justify-content:center;
  align-items:flex-end;
  margin:10px 0 4px;
}
@media (max-width:700px){
  .tower-wrap{ gap:18px; }
}

.tower{
  width:110px;
  text-align:center;
  font-weight:1000;
  position:relative;
}
.tower-year{
  font-size:13px;
  margin-bottom:8px;
  opacity:.95;
}

/* ----- ì‹¤ë¦°ë” ê¸°ë‘¥ ----- */
.tower-pillar{
  position:relative;
  height:240px;
  border-radius:50px;
  background:linear-gradient(180deg,#f2f2f2,#d7d7d7);
  box-shadow:
    inset 8px 0 18px rgba(0,0,0,0.18),
    inset -8px 0 18px rgba(255,255,255,0.7),
    0 16px 40px rgba(0,0,0,.25);
  overflow:hidden;
}

/* ë°”ë‹¥ íƒ€ì› ê·¸ë¦¼ì */
.tower-pillar::before{
  content:"";
  position:absolute;
  bottom:-14px;
  left:50%;
  transform:translateX(-50%);
  width:92%;
  height:26px;
  border-radius:50%;
  background:radial-gradient(circle,rgba(0,0,0,.28),rgba(0,0,0,0));
  filter:blur(4px);
  opacity:.65;
}

/* ìƒë‹¨ ìº¡ */
.tower-pillar::after{
  content:"";
  position:absolute;
  top:-10px;
  left:50%;
  transform:translateX(-50%);
  width:88%;
  height:22px;
  border-radius:50%;
  background:radial-gradient(circle,rgba(255,255,255,0.98),rgba(255,255,255,0));
  opacity:.95;
}

/* ì±„ìš°ê¸° (ì‹¤ì œ ì ìˆ˜) */
.tower-fill{
  position:absolute;
  bottom:0;
  width:100%;
  height:0%;
  border-radius:40px;
  overflow:hidden;
  transition:height 1.2s cubic-bezier(.12,.9,.3,1);
  background-size:100% 22px;
}

/* ì¸¡ë©´ ë°˜ì‚¬ + ê·¸ë¦¼ì */
.tower-fill::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    linear-gradient(90deg,
      rgba(255,255,255,.95) 0%,
      rgba(255,255,255,.35) 12%,
      rgba(0,0,0,0.10) 70%,
      rgba(0,0,0,0.40) 100%);
  mix-blend-mode:overlay;
}

/* ë‚´ë¶€ ë°˜ì§ ìŠ¤íŠ¸ë¼ì´í”„ */
.tower-fill::after{
  content:"";
  position:absolute;
  inset:-40px;
  background:linear-gradient(115deg,
    rgba(255,255,255,0) 35%,
    rgba(255,255,255,.8) 50%,
    rgba(255,255,255,0) 65%);
  animation:shine 1.6s ease-out 0.25s 1;
}
@keyframes shine{
  0%{ transform:translateX(-140%) rotate(-10deg); opacity:0; }
  30%{ opacity:1; }
  100%{ transform:translateX(140%) rotate(-10deg); opacity:0; }
}

/* ì¸µ ë¼ì¸ (ê±´ë¬¼ ëŠë‚Œ) */
.tower-fill{
  background-image:
    repeating-linear-gradient(
      to top,
      rgba(255,255,255,.33) 0,
      rgba(255,255,255,.33) 3px,
      transparent 3px,
      transparent 22px
    );
}

/* ì—°ë„ë³„ ì¡´ì¬ê° ì°¨ì´ */
.tower-year-2025 .tower-fill{ filter:brightness(1.05); }
.tower-year-2024 .tower-fill{ filter:brightness(.98); opacity:.95; }
.tower-year-2023 .tower-fill{ filter:brightness(.92); opacity:.88; }

/* 2025 ë„¤ì˜¨ ê°•ì¡° */
.tower-2025{
  box-shadow:0 0 30px rgba(255,40,40,.7);
  animation:pulseRed 2.5s infinite;
}
@keyframes pulseRed{
  0%{ box-shadow:0 0 22px rgba(255,60,60,.4); }
  50%{ box-shadow:0 0 55px rgba(255,40,40,1); }
  100%{ box-shadow:0 0 22px rgba(255,60,60,.4); }
}

/* ì „í˜•ë³„ ì»¬ëŸ¬ í…Œë§ˆ */
.tower-color-êµê³¼{
  background-image:
    linear-gradient(180deg,#9af7db,#20c7a4);
}
.tower-color-ì¢…í•©{
  background-image:
    linear-gradient(180deg,#d1bcff,#7a45ff);
}
.tower-color-ë…¼ìˆ {
  background-image:
    linear-gradient(180deg,#ffb4d8,#ff3f80);
}
.tower-color-ê¸°íƒ€{
  background-image:
    linear-gradient(180deg,#96c6ff,#2f6dff);
}

/* ë°˜ì§ ìŠ¤íŒŒí´ */
.spark{
  position:absolute;
  top:-22px;
  left:50%;
  transform:translateX(-50%);
  width:70px;
  height:70px;
  background:radial-gradient(circle,rgba(255,255,255,0.95),rgba(255,255,255,0));
  opacity:0;
  pointer-events:none;
}
.spark.on{
  animation:pop 0.9s ease-out 0.1s 1;
}
@keyframes pop{
  0%{ transform:translateX(-50%) scale(.35); opacity:0; }
  35%{ transform:translateX(-50%) scale(1.05); opacity:.95; }
  100%{ transform:translateX(-50%) scale(1.7); opacity:0; }
}

/* ìƒìŠ¹/í•˜ë½ ë°°ì§€ */
.tower-badge{
  position:absolute;
  top:8px;
  left:50%;
  transform:translateX(-50%);
  font-size:11px;
  font-weight:1000;
  padding:4px 10px;
  border-radius:999px;
  box-shadow:0 10px 26px rgba(0,0,0,.18);
  opacity:0;
  user-select:none;
  white-space:nowrap;
}
.tower-badge.on{
  animation:badgeIn .8s ease-out .15s 1 forwards;
}
@keyframes badgeIn{
  0%{ transform:translateX(-50%) translateY(6px) scale(.9); opacity:0; }
  60%{ opacity:1; }
  100%{ transform:translateX(-50%) translateY(0) scale(1); opacity:1; }
}
.badge-up{
  background:linear-gradient(120deg,#ff4d4d,#ff2da0);
  color:#fff;
}
.badge-down{
  background:linear-gradient(120deg,#3f6cff,#26c6ff);
  color:#fff;
}
.badge-same{
  background:#f3f3f3;
  color:#333;
  border:1px solid #e8e8e8;
}

.tower-value{
  margin-top:8px;
  font-size:20px;
  font-weight:1000;
}

/* ëª¨ë°”ì¼ ë†’ì´ ì¡°ì • */
@media (max-width:700px){
  .tower-pillar{ height:190px; }
  .tower{ width:31%; min-width:92px; }
}

/* ===== í…Œì´ë¸” ===== */
table.result-table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
  font-size:14px;
}
table.result-table th,table.result-table td{
  text-align:center;
  padding:7px 4px;
  border-bottom:1px solid #eee;
  border-right:1px solid #eee;
}
table.result-table th:last-child,
table.result-table td:last-child{
  border-right:none;
}
table.result-table th{
  background:#fff3eb;
  font-weight:1000;
}
table.result-table tr.highlight-2025{
  background:#fff8d7;
  font-weight:1000;
  font-size:15px;
}

.diff-up{ color:#e53935; font-weight:1000; }
.diff-down{ color:#1e88e5; font-weight:1000; }
.diff-same{ color:#555; }

/* ===== ë¹„êµ ì¹´ë“œ ë‚´ë¶€ ===== */
.compare-controls{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:space-between;
  margin-bottom:6px;
  flex-wrap:wrap;
}
.pill{
  font-size:12px;
  font-weight:1000;
  padding:6px 10px;
  border-radius:999px;
  background:linear-gradient(145deg,#eef2ff,#dee5ff);
  color:#2f4ecb;
  border:1px solid #d4ddff;
}
.compare-item{
  margin-top:8px;
  padding:10px 10px 12px;
  border-radius:18px;
  border:1px dashed #dde5ff;
  background:rgba(255,255,255,.9);
  backdrop-filter:blur(10px);
}
.compare-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:6px;
  gap:8px;
}
.compare-label{
  font-size:13px;
  font-weight:1000;
}
.compare-label small{
  font-size:11px;
  color:#777;
}
.compare-index-badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:22px;
  height:22px;
  border-radius:999px;
  background:#6b9bff;
  color:#fff;
  font-size:11px;
  margin-right:6px;
}
.btn-mini{
  padding:6px 10px;
  border-radius:999px;
  border:none;
  font-size:12px;
  font-weight:1000;
  cursor:pointer;
  background:#f7f7ff;
}

/* ===== ë¹„êµ ìŠ¬ë¼ì´ë” ===== */
.compare-slider{
  display:flex;
  gap:12px;
  overflow-x:auto;
  padding:6px 2px 10px;
  scroll-snap-type:x mandatory;
  -webkit-overflow-scrolling:touch;
  scroll-behavior:smooth;
}
.compare-slider::-webkit-scrollbar{ height:10px; }
.compare-slider::-webkit-scrollbar-thumb{
  background:rgba(70,110,255,0.18);
  border-radius:999px;
}
.compare-slide{
  scroll-snap-align:center;
  flex:0 0 380px;
  max-width:380px;
}
@media (max-width:700px){
  .compare-slide{ flex:0 0 88%; max-width:88%; }
}

/* ===== ìŠ¬ë¼ì´ë” ë„¤ë¹„ ===== */
.compare-nav{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  margin:6px 0 2px;
}
.nav-btn{
  border:none;
  background:#fff;
  font-size:18px;
  padding:7px 12px;
  border-radius:999px;
  box-shadow:0 6px 16px rgba(0,0,0,.14);
  cursor:pointer;
  user-select:none;
}
.nav-btn:disabled{
  opacity:.45;
  cursor:not-allowed;
}
.page-dots{
  display:flex;
  gap:7px;
  align-items:center;
}
.page-dots button{
  width:9px;
  height:9px;
  border-radius:999px;
  border:none;
  padding:0;
  background:#cfcfcf;
  cursor:pointer;
}
.page-dots button.active{
  background:#ff3d7a;
}

/* ===== ëª¨ë°”ì¼ ìš”ì•½ ì¹´ë“œ ===== */
.mobile-summary{
  display:none;
  margin-top:10px;
  border-radius:16px;
  overflow:hidden;
  border:1px solid #eef1ff;
}
.mobile-summary .row{
  display:flex;
  justify-content:space-between;
  padding:10px 12px;
  background:#fbfcff;
  border-bottom:1px solid #eef1ff;
  font-weight:1000;
}
.mobile-summary .row:last-child{
  border-bottom:none;
}
.mobile-summary .row span:first-child{
  color:#334;
  font-size:13px;
}
.mobile-summary .row span:last-child{
  color:#111;
  font-size:13px;
}

details.fold{
  margin-top:10px;
  border:1px solid #f0f0f0;
  border-radius:14px;
  overflow:hidden;
}
details.fold summary{
  cursor:pointer;
  list-style:none;
  padding:10px 12px;
  font-weight:1000;
  background:#fff7fb;
}
details.fold summary::-webkit-details-marker{ display:none; }
details.fold .inner{
  padding:10px 12px 12px;
  background:#fff;
}

@media (max-width:700px){
  .mobile-summary{ display:block; }
}

/* ë¹ˆ ìƒíƒœ */
.empty-text{ font-size:13px; color:#555; }

/* ìŠ¤ì™€ì´í”„ íŒíŠ¸ */
.swipe-hint{
  position:absolute;
  top:8px;
  left:50%;
  transform:translateX(-50%);
  background:linear-gradient(120deg,#ff7b61,#ff3d7a);
  color:#fff;
  font-size:12px;
  font-weight:1000;
  padding:6px 14px;
  border-radius:999px;
  box-shadow:0 10px 24px rgba(0,0,0,.18);
  animation:pulseHint 1.4s infinite;
  z-index:5;
}
@keyframes pulseHint{
  0%{ transform:translateX(-50%) scale(1); }
  50%{ transform:translateX(-50%) scale(1.05); }
  100%{ transform:translateX(-50%) scale(1); }
}
</style>
</head>

<body>
<canvas id="towerParticles"></canvas>

<div class="page">
  <h1>ëª¨ë‘ì˜ ìˆ˜ì‹œ 3ê°œë…„ ì…ì‹œê²°ê³¼ ë¹„êµ TOWER</h1>
  <div class="sub-title">
    ì„ íƒí•œ ì „í˜•ì˜ <b>ìµœê·¼ 3ê°œë…„ 70% cut ì…ê²° íë¦„</b>ì„<br>
    <b>ì…ì²´ì ì¸ ìƒìŠ¹ íƒ€ì›Œ</b>ë¡œ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.
  </div>
  <div class="meta meta-strong">Copyright @All Teachers</div>
  <div class="meta">ì¶œì²˜: 3ê°œë…„ ì–´ë””ê°€ ìˆ˜ì‹œ ì…ì‹œê²°ê³¼</div>

  <!-- ê²€ìƒ‰ ì¹´ë“œ -->
  <div class="card card-search">
    <div class="card-title">ê²€ìƒ‰ ê¸°ì¤€ ì„ íƒ (ê°€ë¡œ 4ê°œ ë“œë¡­ë‹¤ìš´)</div>
    <div class="search-row">
      <div class="field">
        <select id="univSelect">
          <option value="">ëŒ€í•™ ì„ íƒ</option>
        </select>
      </div>
      <div class="field">
        <select id="majorSelect" disabled>
          <option value="">ëª¨ì§‘ë‹¨ìœ„ ì„ íƒ</option>
        </select>
      </div>
      <div class="field">
        <select id="typeSelect" disabled>
          <option value="">ì „í˜•ìœ í˜• ì„ íƒ</option>
        </select>
      </div>
      <div class="field">
        <select id="detailSelect" disabled>
          <option value="">ì„¸ë¶€ì „í˜• ì„ íƒ</option>
        </select>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-main" id="addCompareBtn" disabled>ï¼‹ ë¹„êµ ì¶”ê°€ (ìµœëŒ€ 3ê°œ)</button>
      <button class="btn btn-ghost" id="toggleCompareViewBtn">â†” ë¹„êµ ìŠ¬ë¼ì´ë“œ ë³´ê¸°</button>
      <button class="btn btn-sub" id="resetBtn">ì„ íƒ ì´ˆê¸°í™”</button>
    </div>
  </div>

  <!-- í˜„ì¬ ì„ íƒ ê²°ê³¼ -->
  <div class="card card-current">
    <div class="card-title">í˜„ì¬ ì„ íƒ 1ê°œ ì „í˜•ì˜ 3ê°œë…„ ê²°ê³¼</div>
    <div id="currentResult">
      <p class="empty-text">
        ì•„ì§ ì„ íƒëœ ì „í˜•ì´ ì—†ìŠµë‹ˆë‹¤.<br>
        ìœ„ì—ì„œ ëŒ€í•™ â†’ ëª¨ì§‘ë‹¨ìœ„ â†’ ì „í˜•ìœ í˜• â†’ ì„¸ë¶€ì „í˜•ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”.
      </p>
    </div>
  </div>

  <!-- ë¹„êµ ëª©ë¡ -->
  <div class="card card-compare">
    <div class="compare-controls">
      <div class="card-title" style="margin:0;">ì„ íƒ ë¹„êµ ëª©ë¡ (ìµœëŒ€ 3ê°œê¹Œì§€ ëˆ„ì )</div>
      <div class="pill" id="compareModePill">ì„¸ë¡œ ëª¨ë“œ</div>
    </div>

    <!-- ìŠ¬ë¼ì´ë” ë„¤ë¹„ -->
    <div class="compare-nav" id="compareNav" style="display:none;">
      <button class="nav-btn" id="prevBtn" aria-label="ì´ì „">â—€</button>
      <div class="page-dots" id="pageDots" aria-label="í˜ì´ì§€ ì¸ë””ì¼€ì´í„°"></div>
      <button class="nav-btn" id="nextBtn" aria-label="ë‹¤ìŒ">â–¶</button>
    </div>

    <div class="empty-text" id="compareEmpty">
      ë¹„êµ ëª©ë¡ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. 'ë¹„êµ ì¶”ê°€' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì „í˜•ì„ ëˆ„ì í•˜ì„¸ìš”.
    </div>
    <div id="compareList"></div>
  </div>
</div>

<script>
/* ===== ìƒìˆ˜/ì „ì—­ ===== */
const YEARS = [2025, 2024, 2023];
let DATA = [];
let INDEX = {};   // {ëŒ€í•™->{ëª¨ì§‘ë‹¨ìœ„->{ì¤‘ì‹¬ì „í˜•->{ì „í˜•ëª…->{ì—°ë„:row}}}}}
let compareSelections = [];
let compareSliderMode = false;

const univSelect   = document.getElementById("univSelect");
const majorSelect  = document.getElementById("majorSelect");
const typeSelect   = document.getElementById("typeSelect");
const detailSelect = document.getElementById("detailSelect");
const addCompareBtn = document.getElementById("addCompareBtn");
const resetBtn       = document.getElementById("resetBtn");
const toggleCompareViewBtn = document.getElementById("toggleCompareViewBtn");
const compareModePill = document.getElementById("compareModePill");

const currentResultBox = document.getElementById("currentResult");
const compareListBox   = document.getElementById("compareList");
const compareEmptyText = document.getElementById("compareEmpty");

const compareNav = document.getElementById("compareNav");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const pageDots = document.getElementById("pageDots");

let currentSlideIndex = 0;

/* ===== ìœ í‹¸ ===== */
function extractYear(value){
  const s = String(value == null ? "" : value);
  const m = s.match(/(\d{4})/);
  return m ? m[1] : null;
}
function isMobile(){
  return window.matchMedia && window.matchMedia("(max-width: 700px)").matches;
}
function fillSelect(select, items, placeholder){
  select.innerHTML = "";
  const opt = document.createElement("option");
  opt.value = "";
  opt.textContent = placeholder;
  select.appendChild(opt);
  items.forEach(function(v){
    const o = document.createElement("option");
    o.value = v;
    o.textContent = v;
    select.appendChild(o);
  });
}
function disableSelect(sel, message){
  sel.disabled = true;
  sel.innerHTML = "";
  const opt = document.createElement("option");
  opt.value = "";
  opt.textContent = message;
  sel.appendChild(opt);
}

/* ===== ë°ì´í„° ë¡œë“œ & ì¸ë±ìŠ¤ ===== */
async function loadData(){
  try{
    const res = await fetch("./data/data.json");
    if(!res.ok) throw new Error("HTTP " + res.status);
    const raw = await res.json();
    if(!Array.isArray(raw)) throw new Error("data.json í˜•ì‹ ì˜¤ë¥˜");
    DATA = raw;
    buildIndex();
    initUnivSelect();
  }catch(e){
    console.error(e);
    univSelect.innerHTML = "<option value=''>data/data.json ë¡œë“œ ì‹¤íŒ¨</option>";
    alert("data/data.json ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. data í´ë”ì™€ íŒŒì¼ëª…ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
  }
}

function buildIndex(){
  INDEX = {};
  for(let i=0;i<DATA.length;i++){
    const row = DATA[i];
    const univ = row["ëŒ€í•™ëª…"];
    const major = row["ëª¨ì§‘ë‹¨ìœ„"];
    const type  = row["ì¤‘ì‹¬ì „í˜•"];
    const detail= row["ì „í˜•ëª…"];
    const y = extractYear(row["ì—°ë„"]);
    if(!univ || !major || !type || !detail || !y) continue;

    if(!INDEX[univ]) INDEX[univ] = {};
    if(!INDEX[univ][major]) INDEX[univ][major] = {};
    if(!INDEX[univ][major][type]) INDEX[univ][major][type] = {};
    if(!INDEX[univ][major][type][detail]) INDEX[univ][major][type][detail] = {};
    INDEX[univ][major][type][detail][y] = row;
  }
}

function initUnivSelect(){
  const univs = Object.keys(INDEX).sort(function(a,b){ return a.localeCompare(b,"ko"); });
  fillSelect(univSelect, univs, "ëŒ€í•™ ì„ íƒ");
  univSelect.disabled = false;
}

/* ===== ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸ ===== */
univSelect.addEventListener("change", function(){
  const univ = univSelect.value;
  disableSelect(majorSelect, "ëª¨ì§‘ë‹¨ìœ„ ì„ íƒ");
  disableSelect(typeSelect, "ì „í˜•ìœ í˜• ì„ íƒ");
  disableSelect(detailSelect, "ì„¸ë¶€ì „í˜• ì„ íƒ");
  addCompareBtn.disabled = true;
  renderCurrentResult(null);

  if(!univ || !INDEX[univ]) return;
  const majors = Object.keys(INDEX[univ]).sort(function(a,b){ return a.localeCompare(b,"ko"); });
  fillSelect(majorSelect, majors, "ëª¨ì§‘ë‹¨ìœ„ ì„ íƒ");
  majorSelect.disabled = true;
  setTimeout(function(){ majorSelect.disabled = false; },0);
});

majorSelect.addEventListener("change", function(){
  const univ = univSelect.value;
  const major= majorSelect.value;
  disableSelect(typeSelect, "ì „í˜•ìœ í˜• ì„ íƒ");
  disableSelect(detailSelect, "ì„¸ë¶€ì „í˜• ì„ íƒ");
  addCompareBtn.disabled = true;
  renderCurrentResult(null);

  if(!univ || !major || !INDEX[univ] || !INDEX[univ][major]) return;
  const types = Object.keys(INDEX[univ][major]).sort(function(a,b){ return a.localeCompare(b,"ko"); });
  fillSelect(typeSelect, types, "ì „í˜•ìœ í˜• ì„ íƒ");
  typeSelect.disabled = false;
});

typeSelect.addEventListener("change", function(){
  const univ = univSelect.value;
  const major= majorSelect.value;
  const type = typeSelect.value;
  disableSelect(detailSelect, "ì„¸ë¶€ì „í˜• ì„ íƒ");
  addCompareBtn.disabled = true;
  renderCurrentResult(null);

  if(!univ || !major || !type) return;
  if(!INDEX[univ] || !INDEX[univ][major] || !INDEX[univ][major][type]) return;

  const details = Object.keys(INDEX[univ][major][type]).sort(function(a,b){ return a.localeCompare(b,"ko"); });
  fillSelect(detailSelect, details, "ì„¸ë¶€ì „í˜• ì„ íƒ");
  detailSelect.disabled = false;
});

detailSelect.addEventListener("change", function(){
  const univ = univSelect.value;
  const major= majorSelect.value;
  const type = typeSelect.value;
  const detail = detailSelect.value;

  const valid = univ && major && type && detail;
  addCompareBtn.disabled = !valid;

  if(!valid){
    renderCurrentResult(null);
    return;
  }
  renderCurrentResult({ univ:univ, major:major, type:type, detail:detail });
});

/* ===== ì„ íƒ ì „í˜•ì˜ 3ê°œë…„ row ===== */
function getRowsForSelection(sel){
  if(!sel) return null;
  const univ = sel.univ;
  const major= sel.major;
  const type = sel.type;
  const detail = sel.detail;

  const rowsByYear = {};
  YEARS.forEach(function(y){
    const key = String(y);
    if(
      INDEX[univ] &&
      INDEX[univ][major] &&
      INDEX[univ][major][type] &&
      INDEX[univ][major][type][detail] &&
      INDEX[univ][major][type][detail][key]
    ){
      rowsByYear[y] = INDEX[univ][major][type][detail][key];
    }else{
      rowsByYear[y] = null;
    }
  });
  return rowsByYear;
}

/* ===== ì¦ê° í…ìŠ¤íŠ¸ ===== */
function createDiffText(currentRow, prevRow){
  if(!currentRow || !prevRow) return { html:"-", cls:"diff-same" };

  const c = Number(currentRow["70% cut"]);
  const p = Number(prevRow["70% cut"]);
  if(Number.isNaN(c) || Number.isNaN(p)) return { html:"-", cls:"diff-same" };

  const diff = p - c; // ì´ì „ - í˜„ì¬
  if(diff > 0) return { html:"â–² " + Math.abs(diff).toFixed(2) + " ìƒìŠ¹", cls:"diff-up" };
  if(diff < 0) return { html:"â–¼ " + Math.abs(diff).toFixed(2) + " í•˜ë½", cls:"diff-down" };
  return { html:"â– ë™ì¼", cls:"diff-same" };
}

/* ===== í…Œì´ë¸” ë¸”ë¡ ===== */
function createTableBlock(rowsByYear){
  const table = document.createElement("table");
  table.className = "result-table";

  const headerRow = document.createElement("tr");
  ["ì—°ë„","50% cut","70% cut","ì¦ê°(70%)","ëª¨ì§‘ì¸ì›","ê²½ìŸë¥ ","ì¶©ì›ìˆœìœ„"]
    .forEach(function(h){
      const th = document.createElement("th");
      th.textContent = h;
      headerRow.appendChild(th);
    });
  table.appendChild(headerRow);

  YEARS.forEach(function(year, idx){
    const tr = document.createElement("tr");
    if(year === 2025) tr.classList.add("highlight-2025");

    const row = rowsByYear[year];
    const prevYear = YEARS[idx+1];
    const prevRow = prevYear ? rowsByYear[prevYear] : null;
    const diff = createDiffText(row, prevRow);

    function val(key){
      if(!row || row[key] == null || row[key] === "") return "-";
      return row[key];
    }

    const cols = [
      year,
      val("50% cut"),
      val("70% cut"),
      { diff:diff },
      val("ëª¨ì§‘ì¸ì›"),
      val("ê²½ìŸë¥ "),
      val("ì¶©ì›ìˆœìœ„")
    ];

    cols.forEach(function(v,i){
      const td = document.createElement("td");
      if(i === 3 && v && v.diff){
        td.innerHTML = '<span class="' + v.diff.cls + '">' + v.diff.html + '</span>';
      }else{
        td.textContent = v;
      }
      tr.appendChild(td);
    });
    table.appendChild(tr);
  });

  return table;
}

/* ===== ëª¨ë°”ì¼ ìš”ì•½ ===== */
function createMobileSummary(rowsByYear){
  const box = document.createElement("div");
  box.className = "mobile-summary";

  YEARS.forEach(function(year, idx){
    const row = rowsByYear[year];
    const prevYear = YEARS[idx+1];
    const prevRow = prevYear ? rowsByYear[prevYear] : null;
    const diff = createDiffText(row, prevRow);

    let v = null;
    if(row && row["70% cut"] !== "" && row["70% cut"] != null){
      v = Number(row["70% cut"]);
    }
    const text = (v !== null && !Number.isNaN(v)) ? v.toFixed(2) + "ë“±ê¸‰" : "-";

    const r = document.createElement("div");
    r.className = "row";
    r.innerHTML =
      '<span>' + year + ' Â· 70% cut</span>' +
      '<span>' + text +
      ' <em style="font-style:normal; margin-left:6px;" class="' + diff.cls + '">' +
      diff.html + '</em></span>';
    box.appendChild(r);
  });

  return box;
}

/* ===== 3D íƒ€ì›Œ ë¸”ë¡ (ì „í˜• ì»¬ëŸ¬ ì ìš©) ===== */
function createScoreTowerBlock(selection, rowsByYear){
  const stage = document.createElement("div");
  stage.className = "tower-stage";

  const wrap = document.createElement("div");
  wrap.className = "tower-wrap";

  const typeName = selection.type || "";

  YEARS.forEach(function(year, idx){
    const col = document.createElement("div");
    col.className = "tower tower-year-" + year;

    const label = document.createElement("div");
    label.className = "tower-year";
    label.textContent = year + "í•™ë…„ë„";
    col.appendChild(label);

    const pillar = document.createElement("div");
    pillar.className = "tower-pillar";

    const fill = document.createElement("div");
    fill.className = "tower-fill";

    // ì „í˜•ë³„ ìƒ‰ìƒ class
    let colorClass = "tower-color-ê¸°íƒ€";
    if(typeName.indexOf("êµê³¼") !== -1) colorClass = "tower-color-êµê³¼";
    else if(typeName.indexOf("ì¢…í•©") !== -1) colorClass = "tower-color-ì¢…í•©";
    else if(typeName.indexOf("ë…¼ìˆ ") !== -1) colorClass = "tower-color-ë…¼ìˆ ";

    fill.classList.add(colorClass);
    if(year === 2025) fill.classList.add("tower-2025");

    const spark = document.createElement("div");
    spark.className = "spark";

    const row = rowsByYear[year];
    let value = null;
    if(row && row["70% cut"] !== undefined && row["70% cut"] !== ""){
      const n = Number(row["70% cut"]);
      if(!Number.isNaN(n)) value = n;
    }

    // ë†’ì´ ë§¤í•‘: 1ë“±ê¸‰(ë†’ìŒ) ~ 6ë“±ê¸‰(ë‚®ìŒ) ê³¼ì¥
    let height = 8;
    if(value !== null){
      const norm = (6 - value) / 5;
      const clamped = Math.max(0, Math.min(1, norm));
      const exaggerated = Math.pow(clamped, 1.22);
      height = 10 + exaggerated * 85;
    }

    const prevYear = YEARS[idx+1];
    let badgeText = "";
    let badgeClass = "badge-same";
    if(prevYear && rowsByYear[prevYear] && value !== null){
      const prev = Number(rowsByYear[prevYear]["70% cut"]);
      if(!Number.isNaN(prev)){
        const diff = prev - value;
        if(diff > 0){
          badgeText = "â–² +" + diff.toFixed(2);
          badgeClass = "badge-up";
        }else if(diff < 0){
          badgeText = "â–¼ -" + Math.abs(diff).toFixed(2);
          badgeClass = "badge-down";
        }else{
          badgeText = "â– 0.00";
          badgeClass = "badge-same";
        }
      }
    }

    const badge = document.createElement("div");
    badge.className = "tower-badge " + badgeClass;
    if(badgeText) badge.textContent = badgeText;

    pillar.appendChild(fill);
    pillar.appendChild(spark);
    if(badgeText) pillar.appendChild(badge);

    col.appendChild(pillar);

    const valueText = document.createElement("div");
    valueText.className = "tower-value";
    valueText.textContent = (value !== null)
      ? value.toFixed(2) + "ë“±ê¸‰"
      : "ë°ì´í„° ì—†ìŒ";
    col.appendChild(valueText);

    setTimeout(function(){
      fill.style.height = height + "%";
      spark.classList.add("on");
      if(badgeText) badge.classList.add("on");

      // íŒŒí‹°í´
      const rect = pillar.getBoundingClientRect();
      spawnParticles(rect.left + rect.width/2, rect.top + 10);
    }, 120 + (idx * 90));

    wrap.appendChild(col);
  });

  stage.appendChild(wrap);
  return stage;
}

/* ===== ê²°ê³¼ ë¸”ë¡ ===== */
function createResultBlock(selection, rowsByYear, opts){
  opts = opts || {};
  const compact = !!opts.compact;

  const container = document.createElement("div");

  const title = document.createElement("div");
  title.className = "result-title";
  title.textContent = selection.univ + " / " + selection.major;
  container.appendChild(title);

  const sub = document.createElement("div");
  sub.className = "result-sub";
  sub.textContent =
    "[" + selection.type + "] " + selection.detail +
    " Â· 3ê°œë…„ 70% cut ì…ê²° ìƒìŠ¹ íƒ€ì›Œ";
  container.appendChild(sub);

  const header = document.createElement("div");
  header.className = "result-header";
  header.textContent = "ğŸ›ï¸ 70% cut ê¸°ì¤€ìœ¼ë¡œ ìµœê·¼ 3ê°œë…„ ì…ê²° íë¦„ì„ â€˜ìƒìŠ¹ íƒ€ì›Œâ€™ë¡œ ì‹œê°í™”í–ˆìŠµë‹ˆë‹¤.";
  container.appendChild(header);

  container.appendChild(createScoreTowerBlock(selection, rowsByYear));

  if(compact){
    container.appendChild(createMobileSummary(rowsByYear));

    const d = document.createElement("details");
    d.className = "fold";
    d.innerHTML = '<summary>ìì„¸íˆ ë³´ê¸° (í‘œ í¼ì¹˜ê¸°)</summary><div class="inner"></div>';
    d.querySelector(".inner").appendChild(createTableBlock(rowsByYear));
    container.appendChild(d);
  }else{
    const header2 = document.createElement("div");
    header2.className = "result-header";
    header2.style.marginTop = "8px";
    header2.textContent =
      "ğŸ“Š 3ê°œë…„ 50% Â· 70% Â· ëª¨ì§‘ì¸ì› Â· ê²½ìŸë¥  Â· ì¶©ì›ìˆœìœ„ë¥¼ í•¨ê»˜ í™•ì¸í•´ ë³´ì„¸ìš”. (2025 í•˜ì´ë¼ì´íŠ¸)";
    container.appendChild(header2);

    container.appendChild(createTableBlock(rowsByYear));
  }

  return container;
}

/* ===== í˜„ì¬ ì„ íƒ ê²°ê³¼ ë Œë”ë§ ===== */
function renderCurrentResult(selection){
  currentResultBox.innerHTML = "";
  if(!selection){
    const p = document.createElement("p");
    p.className = "empty-text";
    p.innerHTML =
      "ì•„ì§ ì„ íƒëœ ì „í˜•ì´ ì—†ìŠµë‹ˆë‹¤.<br>ëŒ€í•™ Â· ëª¨ì§‘ë‹¨ìœ„ Â· ì „í˜•ìœ í˜• Â· ì„¸ë¶€ì „í˜•ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”.";
    currentResultBox.appendChild(p);
    return;
  }

  const rowsByYear = getRowsForSelection(selection);
  const hasAny = YEARS.some(function(y){ return rowsByYear[y]; });
  if(!hasAny){
    const p = document.createElement("p");
    p.className = "empty-text";
    p.textContent = "í•´ë‹¹ ì „í˜•ì— ëŒ€í•œ 3ê°œë…„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
    currentResultBox.appendChild(p);
    return;
  }

  currentResultBox.appendChild(
    createResultBlock(selection, rowsByYear, { compact:isMobile() })
  );
}

/* ===== ë¹„êµ ìŠ¬ë¼ì´ë” ë„¤ë¹„ ===== */
function buildCompareNav(total){
  pageDots.innerHTML = "";
  for(let i=0;i<total;i++){
    const dot = document.createElement("button");
    dot.type = "button";
    if(i === currentSlideIndex) dot.className = "active";
    dot.setAttribute("aria-label","ë¹„êµ " + (i+1) + "ë²ˆì§¸");
    dot.addEventListener("click", function(){ goToSlide(i); });
    pageDots.appendChild(dot);
  }
  prevBtn.disabled = (currentSlideIndex <= 0);
  nextBtn.disabled = (currentSlideIndex >= total-1);
}
function getSliderEl(){
  return compareListBox.querySelector(".compare-slider");
}
function goToSlide(idx){
  const slider = getSliderEl();
  const slides = slider ? slider.querySelectorAll(".compare-slide") : [];
  if(!slider || !slides.length) return;

  const clamped = Math.max(0, Math.min(slides.length-1, idx));
  currentSlideIndex = clamped;
  slides[clamped].scrollIntoView({ behavior:"smooth", inline:"center", block:"nearest" });
  buildCompareNav(slides.length);
}
prevBtn.addEventListener("click", function(){ goToSlide(currentSlideIndex - 1); });
nextBtn.addEventListener("click", function(){ goToSlide(currentSlideIndex + 1); });

function attachSliderScrollListener(){
  const slider = getSliderEl();
  if(!slider) return;

  let ticking = false;
  slider.addEventListener("scroll", function(){
    if(ticking) return;
    ticking = true;
    requestAnimationFrame(function(){
      const slides = slider.querySelectorAll(".compare-slide");
      if(slides.length){
        const rect = slider.getBoundingClientRect();
        const center = rect.left + rect.width/2;

        let best = 0;
        let bestDist = Infinity;
        slides.forEach(function(s,i){
          const r = s.getBoundingClientRect();
          const c = r.left + r.width/2;
          const d = Math.abs(center - c);
          if(d < bestDist){
            bestDist = d;
            best = i;
          }
        });
        if(best !== currentSlideIndex){
          currentSlideIndex = best;
          buildCompareNav(slides.length);
        }
      }
      ticking = false;
    });
  },{ passive:true });
}

/* ===== ë¹„êµ ëª©ë¡ ë Œë”ë§ ===== */
function renderCompareList(){
  compareListBox.innerHTML = "";
  if(compareSelections.length === 0){
    compareEmptyText.style.display = "block";
    compareNav.style.display = "none";
    return;
  }
  compareEmptyText.style.display = "none";

  const autoSlider = (isMobile() && compareSelections.length >= 2);
  const useSlider = compareSliderMode || autoSlider;

  let host;
  if(useSlider){
    host = document.createElement("div");
    host.className = "compare-slider";
    compareListBox.appendChild(host);
  }else{
    host = compareListBox;
  }

  if(useSlider && compareSelections.length >= 2){
    const hint = document.createElement("div");
    hint.className = "swipe-hint";
    hint.textContent = "â† ì¢Œìš°ë¡œ ë°€ì–´ ë¹„êµí•˜ì„¸ìš” â†’";
    compareListBox.prepend(hint);
  }

  compareSelections.forEach(function(sel,index){
    const rowsByYear = getRowsForSelection(sel);
    const hasAny = YEARS.some(function(y){ return rowsByYear[y]; });

    const item = document.createElement("div");
    item.className = "compare-item";

    const header = document.createElement("div");
    header.className = "compare-header";

    const left = document.createElement("div");
    left.className = "compare-label";
    left.innerHTML =
      '<span class="compare-index-badge">' + (index+1) + '</span>' +
      sel.univ + " / " + sel.major +
      '<br><small>[' + sel.type + '] ' + sel.detail + "</small>";

    const right = document.createElement("div");
    const btnDel = document.createElement("button");
    btnDel.className = "btn-mini";
    btnDel.textContent = "ì‚­ì œ";
    btnDel.onclick = function(){
      compareSelections.splice(index,1);
      currentSlideIndex = 0;
      renderCompareList();
    };
    right.appendChild(btnDel);

    header.appendChild(left);
    header.appendChild(right);
    item.appendChild(header);

    if(!hasAny){
      const p = document.createElement("p");
      p.className = "empty-text";
      p.textContent = "ì´ ì „í˜•ì€ 3ê°œë…„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
      item.appendChild(p);
    }else{
      item.appendChild(
        createResultBlock(sel, rowsByYear, { compact:isMobile() })
      );
    }

    if(useSlider){
      const slide = document.createElement("div");
      slide.className = "compare-slide";
      slide.appendChild(item);
      host.appendChild(slide);
    }else{
      host.appendChild(item);
    }
  });

  if(useSlider && compareSelections.length >= 2){
    compareNav.style.display = "flex";
    currentSlideIndex = Math.max(0, Math.min(currentSlideIndex, compareSelections.length-1));
    buildCompareNav(compareSelections.length);
    attachSliderScrollListener();
    setTimeout(function(){ goToSlide(currentSlideIndex); },80);
  }else{
    compareNav.style.display = "none";
  }
}

/* ===== ë¹„êµ ì¶”ê°€ ===== */
addCompareBtn.addEventListener("click", function(){
  const univ = univSelect.value;
  const major= majorSelect.value;
  const type = typeSelect.value;
  const detail = detailSelect.value;

  if(!univ || !major || !type || !detail){
    alert("ëŒ€í•™, ëª¨ì§‘ë‹¨ìœ„, ì „í˜•ìœ í˜•, ì„¸ë¶€ì „í˜•ì„ ëª¨ë‘ ì„ íƒí•œ í›„ ë¹„êµë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”.");
    return;
  }
  if(compareSelections.length >= 3){
    alert("ë¹„êµ ëª©ë¡ì€ ìµœëŒ€ 3ê°œê¹Œì§€ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    return;
  }

  const exists = compareSelections.some(function(s){
    return s.univ===univ && s.major===major && s.type===type && s.detail===detail;
  });
  if(exists){
    alert("ì´ë¯¸ ë¹„êµ ëª©ë¡ì— ìˆëŠ” ì „í˜•ì…ë‹ˆë‹¤.");
    return;
  }

  compareSelections.push({ univ:univ, major:major, type:type, detail:detail });

  if(isMobile() && compareSelections.length >= 2){
    compareSliderMode = true;
  }
  syncCompareModeUI();
  currentSlideIndex = 0;
  renderCompareList();
});

/* ===== ì´ˆê¸°í™” ===== */
resetBtn.addEventListener("click", function(){
  univSelect.selectedIndex = 0;
  disableSelect(majorSelect, "ëª¨ì§‘ë‹¨ìœ„ ì„ íƒ");
  disableSelect(typeSelect, "ì „í˜•ìœ í˜• ì„ íƒ");
  disableSelect(detailSelect, "ì„¸ë¶€ì „í˜• ì„ íƒ");
  addCompareBtn.disabled = true;

  compareSelections = [];
  compareSliderMode = false;
  currentSlideIndex = 0;

  syncCompareModeUI();
  renderCurrentResult(null);
  renderCompareList();
});

/* ===== ìŠ¬ë¼ì´ë“œ/ì„¸ë¡œ ë³´ê¸° í† ê¸€ ===== */
toggleCompareViewBtn.addEventListener("click", function(){
  compareSliderMode = !compareSliderMode;
  currentSlideIndex = 0;
  syncCompareModeUI();
  renderCompareList();
});
function syncCompareModeUI(){
  compareModePill.textContent = compareSliderMode ? "ìŠ¬ë¼ì´ë“œ ëª¨ë“œ" : "ì„¸ë¡œ ëª¨ë“œ";
  toggleCompareViewBtn.textContent = compareSliderMode
    ? "â†• ë¹„êµ ì„¸ë¡œ ë³´ê¸°"
    : "â†” ë¹„êµ ìŠ¬ë¼ì´ë“œ ë³´ê¸°";
}

/* ===== ë°˜ì‘í˜• ë³€ê²½ ì‹œ ì¬ë Œë” ===== */
window.addEventListener("resize", function(){
  const univ = univSelect.value;
  const major= majorSelect.value;
  const type = typeSelect.value;
  const detail = detailSelect.value;

  if(univ && major && type && detail){
    renderCurrentResult({ univ:univ, major:major, type:type, detail:detail });
  }
  renderCompareList();
});

/* ===== íŒŒí‹°í´ ë°°ê²½ ===== */
const canvas = document.getElementById("towerParticles");
const ctx = canvas.getContext("2d");
let particles = [];

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

function spawnParticles(x,y){
  for(let i=0;i<18;i++){
    particles.push({
      x:x,
      y:y,
      vx:(Math.random()-0.5)*2.5,
      vy:-Math.random()*3,
      life:60
    });
  }
}

function animateParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  particles = particles.filter(function(p){ p.life--; return p.life > 0; });
  particles.forEach(function(p){
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.05;
    ctx.fillStyle = "rgba(255,215,230," + (p.life/60) + ")";
    ctx.beginPath();
    ctx.arc(p.x,p.y,2,0,Math.PI*2);
    ctx.fill();
  });
  requestAnimationFrame(animateParticles);
}
animateParticles();

/* ===== ì´ˆê¸° ì‹¤í–‰ ===== */
loadData();
renderCompareList();
syncCompareModeUI();
</script>

</body>
</html>
